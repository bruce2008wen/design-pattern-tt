## 代理模式

代理模式给某一个对象提供一个代理对象，并由代理对象控制对原对象的引用。通俗的来讲代理模式就是我们生活中常见的中介。



### 代理模式类结构:

**类图**

![工厂方法类图](./images/proxy.png)



代理类通常通过持有委托类的实例，来提供委托类的功能，也可以通过继承委托类来实现。

### 优点

（1）实现委托类的功能扩展，符合开闭原则。

（2）实现调用方与委托类的解耦。

（3）实现关键业务逻辑与扩展业务逻辑的分离【分层】。

（4）通过缓存委托类的处理结果，提升运行效率。																																																				

### 缺点

代理类需与被代理类实现同样的接口，有一定的局限性。

需每一个服务都得创建代理类，工作量太大，不易管理。同时接口一旦发生改变，代理类也得相应修改。

### 使用场景

在不修改委托类的情况下，扩展委托类的功能；

在核心业务逻辑之外，实现一些外围的扩展，如日志、缓存等。【类似aop】

实现对委托类某些方法的屏蔽。

### 代码

略

### 代理的种类

- 虚代理

  根据需要创建开销很大的对象。懒加载的一种实现方式，即在必须访问委托类的时候，才创建并持有委托类的实例。

- COW代理

  COW即copy-on-write。拷贝一个庞大而复杂的对象是一种开销很大的操作，如果这个拷贝根本没有被修改，那么这些开销就没有必要。用代理延迟这一拷贝过程，我们可以保证只有当这个对象被修改的时候才对它进行拷贝。

- 远程代理

  为一个对象在不同的地址空间提供局部代表。

- 保护代理

  控制对原始对象的访问。保护代理用于对象应该有不同的访问权限的时候。

- 智能指引

  取代了简单的指针，它在访问对象时执行一些附加操作。它的典型用途包括：

  1. 对指向实际对象的引用计数，这样当该对象没有引用时，可以自动释放它。
  2. 当第一次引用一个持久对象时，将它装入内存。
  3. 在访问一个实际对象前，检查是否已经锁定了它，以确保其他对象不能改变它。

- Cache 代理

- 防火墙代理

- 同步代理

  



**[https://baike.baidu.com/item/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/8374046?fr=aladdin](https://baike.baidu.com/item/代理模式/8374046?fr=aladdin)**

当一个复杂对象的多份副本须存在时，代理模式可以结合[享元模式](https://baike.baidu.com/item/享元模式)以减少存储器用量。

对于被代理的类，在其提供的方法上，需要扩展功能，但接口不变，代理类实现了与被代理类同样的接口，而调用方调用代理类接口，就可以访问到扩展的功能，而不用去了解具体是哪个类提供了服务。是”开闭原则“的应用。

代理的价值：

扩展功能，可在原有功能的基础上，增加处理逻辑

缓存结果

https://blog.csdn.net/zhen921/article/details/82179845

https://segmentfault.com/a/1190000019433930?utm_source=tag-newest

**中介隔离作用：**在某些情况下，一个客户类不想或者不能直接引用一个委托对象，而代理类对象可以在客户类和委托对象之间起到中介的作用，其特征是代理类和委托类实现相同的接口。
**开闭原则，增加功能：**代理类除了是客户类和委托类的中介之外，我们还可以通过给代理类增加额外的功能来扩展委托类的功能，这样做我们只需要修改代理类而不需要再修改委托类，符合代码设计的开闭原则。代理类主要负责为委托类预处理消息、过滤消息、把消息转发给委托类，以及事后对返回结果的处理等。代理类本身并不真正实现服务，而是同过调用委托类的相关方法，来提供特定的服务。真正的业务功能还是由委托类来实现，但是可以在业务功能执行的前后加入一些公共的服务。例如我们想给项目加入缓存、日志这些功能，我们就可以使用代理类来完成，而没必要修改已经封装好的委托类。


